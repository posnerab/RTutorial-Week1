
---
title: Problem Set week_one
output: 
  html_document: 
    keep_md: yes
    toc: yes
---

```{r setup, include=FALSE, echo=FALSE}
# Load libraries and source extra code
library(tidyverse)
library(readr)
library(readxl)
library(RTutor)
source("wcgs.R")

# Options for rendering data frames
# If you knit to a Word docx file, try
# 
# data.frame.theme="word" 
# 
# (needs RStudio > 1.2.1)
# 
# You can also set the options like
# table.max.cols as chunk options
# Makes sense if there are too many, too wide
# columns in some chunks

RTutor::set.knit.print.opts(data.frame.theme="code", table.max.rows=25, table.max.cols=NULL, round.digits=5, signif.digits=8)


# continue knitting even if there is an error
knitr::opts_chunk$set(error = TRUE) 
```


## Exercise Overview

<h1>Week 1 - Descriptive Statistics & Data Visualization using ggplot2</h1>
<ul>
<li>Access this week's bCourses site <a href="https://bcourses.berkeley.edu/courses/1492259/pages/week-1", target = _blank>here</a></li>
</ul>


<h4>Author: Xander Posner, Epi/Biostat MPH '20</h4>
<h4>Check out the <code>source code</code> for this project on <a href="https://github.com/posnerab/RTutorial-Week1", target = _blank>Github</a></h4>



<h3>Tools Used in this Tutorial</h3>

<p>In this tutorial, we will: </p>

<ul>
<li>Change some variable types (e.g., character to numeric)</li>
<li>Dichotomize the BMI variable (change from continuous to binary)</li>
<li>Generate summary statistics and figures</li>
<li>Interpret your summary statistics and figures</li>
</ul>


<h3>R Packages Used in this Tutorial</h3>

<ul>
<li><code>"tidyverse"</code></li>
<li><code>"readxl"</code></li>
<li><code>"readr"</code></li>
</ul>

<p>When practicing on your own in RStudio, you will first need to install each of these packages using the <code>install.packages("")</code> function, putting the name(s) of the package(s) inside the quotation marks like this:</p> 

<div id="block-quotes" class="section level2">
<blockquote>
<p><code>install.packages("tidyverse")</code> OR <code>install.packages(c("tidyverse", "readxl"))</code></p>
</blockquote>
</div>

<p>You <strong>won't</strong> need to <i>install</i> packages more than once on the same computer.</p>

<p>After installing, you must load each package library <strong>separately</strong>, using the <code>library()</code> function, putting the name of each package inside the parentheses without quotation marks like this:</p>

<div id="block-quotes" class="section level2">
<blockquote>
<li><p><code>library(tidyverse)</code></p></li>
<li><p><code>library(readxl)</code></p></li>
</blockquote>
</div>

<p>You <strong>will</strong> need to <i>load</i> packages each time you need to use them, using the <code>library()</code> function whenever you initiate a new R session.</p> 

<p><strong>You don't need to install any packages for this tutorial</strong>. Just press <strong>check</strong> to run any chunk with a <code>library()</code> function in it.</p>


<h3>R Functions Used in this Tutorial</h3>

<ul>
<li><code>library()</code> to load each package library</li>
<li><code>read_excel()</code> to read in Excel spreadsheets</li>
<li><code>head()</code> to view the first few lines of your dataset</li>
<li><code>nrow()</code> to view the number of rows in your dataset</li>
<li><code>str()</code> to view the "structure" of your dataset, including variable names and types</li>
<li><code>summary()</code> to produce summary statistics</li>
<li><code>mean()</code> to find the mean of a given variable</li>
<li><code>sd()</code> to find the standard deviation of a given variable</li>
<li><code>geom_hist()</code> and <code>geom_bar()</code> from the <code>ggplot</code> package to create histograms and bar charts</li>
</ul>


Click the "Go to next exercise..." button to continue.


## Exercise 1 -- Get Started

<p>Some code chunks are finished for you; just press <strong>check</strong> to proceed. Other chunks require you to modify and/or add code before pressing <strong>check</strong> to move through the tutorial.</p>
<p>If you get stuck, use the <strong>hint</strong> in each code chunk first. If you're still having trouble, head to Piazza and post your question.</p>

<strong>Make sure you run each chunk in order!</strong>

<h3>Get to Know Your Data</h3> 


a) Get to know the <code>wcgs</code> dataset. Click "check" to observe what these functions do.
```{r "1_a"}
head(wcgs) # view the first six rows of the dataset in table format
```


b) View the number of rows in your dataset, which here amounts to our sample size, $n$.
```{r "1_b_2"}
n <- nrow(wcgs)
```

<p>Notice that when we assigned the <code>nrow() function</code> to the <code>object</code> named <code>n</code>, R doesn't immediately <i>print</i> the result. Instead the resulting value is saved in your <code>Global Environment</code>.</p>

c) Here are the ways you can have the results of a function print to your Console. Press <strong>check</strong> to observe.
```{r "1_c_3"}
nrow(wcgs) # PRINTS to the console but DOES NOT save the value

n <- nrow(wcgs) # SAVES the value but DOES NOT print

n # PRINTS out the results that you previously saved above

n + 1 # adds 1 to the value saved in the n object: example of what you can do with stored objects in your environment

print(n <- nrow(wcgs)) # SAVES the value AND also PRINTS to the console in one step
```

<p><strong>NOTE. R is cAsE sEnSiTiVe.</strong><code>N</code> would be an entirely separate object from <code>n</code> from R's perspective.</p>



<h3>Summarizing your data</h3> 

<p>R has many ways to view summary statistics. The simplest is the <code>summary()</code> function.</p>

d) Run the chunk below to see what summary statistics the <code>summary()</code> function produces.
```{r "1_d_4"}
summary(wcgs)
```

<p>You will notice the <code>summary()</code> function prints out the following values for each variable in the <code>wcgs</code> dataset:<p>
<ul>
<li>The minimum value</li>
<li>The value at Q1, the first quartile (25th percentile)</li>
<li>The median value or Q2 (50th percentile)</li>
<li>The mean (average) value</li>
<li>The value at Q3, the third quartile (75th percentile)</li>
<li>The maximum value</li>
</ul>

e) Use the dollar sign <code>$</code> to access different variables in your dataset. The first one is done for you. Fill in the code below to summarize the Height0 variable.
```{r "1_e_5"}
summary(wcgs$Age0)
sum_Height0 <- "<<<<<<YOUR CODE HERE>>>>>>"
sum_Height0
sum_Height0 <- summary(wcgs$Height0)
sum_Height0
```



***

### Award: Summary
You summarized it! Click 'Go to next exercise...' to continue.

***


## Exercise 2 -- Modify Your Dataset

<h3>Make Factor Variables</h3>

a) First, view the structure of your dataset using the <code>str()</code> function. Click <strong>Check</strong> to observe. Notice the different variable "types."
```{r "2_a_6"}
str(wcgs)
```

b) Now create a new variable that's equal to 1 if someone currently smokes any cigarettes and 0 if they don't
```{r "2_b_7"}
wcgs$Smoker0 <- 1 # creates a new variable called Smoker0 and sets the value for all individuals to 1

wcgs$Smoker0[wcgs$Ncigs0 == 0] <- 0
```

<p>The square brackets indicate an R operation called "subsetting." This operation tells R to set the value of <code>Smoker0</code> to 0 if the <code>Ncigs0</code> value for that individual is 0.</p>

<p><strong>Note that we had to use two equal signs when we specified the condition for subsetting.</strong> This isn't the case when using symbols for greater than/equal to (> / >=) or less than/equal to (< / <=).</p>


c) Now try making a "yes/no" factor variable for systolic blood pressure, <code>Sbp0</code>, just like we did for smoking above. Call the new variable <code>HighSbp0</code> and set it equal to 0 if <code>Sbp0</code> is less than (<) 140.
```{r "2_c_8"}
wcgs$HighSbp0 <- "<<<<<<YOUR CODE HERE>>>>>>"

"<<<<<<YOUR CODE HERE>>>>>>" <- 0
wcgs$HighSbp0 <- 1

wcgs$HighSbp0[wcgs$Sbp0 < 140] <- 0
```


<h3>Create a new BMI variable</h3>

<p>The <code>wcgs</code> dataset has the height variable, <code>Height0</code>, in inches (in) and the weight variable, <code>Weight0</code>, in pounds (lbs). We want to analyze BMI, which is equal to weight (mass) in kilograms divided by height in meters squared, so we'll have to convert height to centimeters (cm) and weight to kilograms (kg).

d) Create new variables for height, weight, and BMI in the wcgs dataset by using the assignment operator (<-) like so:
```{r "2_d_9"}
wcgs$Heightcm0 <- wcgs$Height0 * 2.54
# this line of code tells R to take the Height0 value for each individual (row) in the dataset, multiply it by 2.54 and then add the value to a new variable (column) we named Heightcm0.

wcgs$Weightkg0 <- wcgs$Weight0/2.2

wcgs$BMI0 <- wcgs$Weightkg0/((wcgs$Heightcm0/100)^2)
```

e) This chunk writes the <code>wcgs</code>data frame, including the new variables we created, to a comma separated value (.csv) file named "wcgs_data_new.csv". The csv file is then loaded into R and assigned to the <code>wcgs_new</code> object so it can be called later on.
```{r "2_e_10"}
wcgs_new <- write_csv(wcgs, "wcgs_data_new.csv")
```


f) Now, use the head() function again to view the first six lines of the <code>wcgs_new</code> dataset. You will notice that there are now five new columns with the variable names we assigned and the values we calculated.
```{r "2_f_11"}
head(wcgs_new)
```

## Exercise 3 -- Create Histograms & Box Plots

a) Create a histogram for the <code>Sbp0</code> variable.
```{r "3_a_12"}
ggplot(wcgs_new, aes(x = Sbp0, y = ..density..)) +
  geom_histogram(binwidth = 10, 
                 color = "black", 
                 fill = "blue") +
  labs(title = "WCGS Systolic Blood Pressure at Baseline", 
       subtitle = "n = 3154 men ages 39 to 59", 
       x = "SBP in mmHg", y = "Density" ) +
  scale_x_continuous(limits = c(0, 250), 
                     breaks = c(50, 100, 150, 200, 250), 
                     labels = c(50, 100, 150, 200, 250)) +
  theme(plot.title = element_text(hjust = 0.5), 
        plot.subtitle = element_text(hjust = 0.5))
```

b) Create a box plot for the <code>Sbp0</code> variable.
```{r "3_b_13"}
ggplot(wcgs_new, aes(y = Sbp0)) +
  geom_boxplot(width = 0.5) +
  scale_x_continuous(labels = NULL) +
  labs(y = "SBP in mmHg", 
       x = "", 
       title = "WCGS Systolic Blood Pressure at Baseline", 
       subtitle = "n = 3154 men ages 39 to 59") +
  theme(plot.title = element_text(hjust = 0.5), 
        plot.subtitle = element_text(hjust = 0.5))
```

